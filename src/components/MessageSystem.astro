---
/* Sistema de mensajes â€” activado por rally */
---

<div class="msg-layer" id="msg-layer">
	<div class="msg-photo" id="msg-photo">
		<img src="/haru2.webp" alt="Haru" class="msg-photo__img" />
	</div>
	<p class="msg" id="message-display"></p>
	<p class="msg-counter" id="msg-counter"></p>
</div>

<style>
	.msg-layer {
		position: fixed;
		bottom: 0;
		left: 0;
		right: 0;
		z-index: 30;
		padding: 1rem 1.5rem 2rem;
		text-align: center;
		pointer-events: none;
		opacity: 0;
		transition: opacity 0.7s ease;
		background: linear-gradient(to top, var(--bg) 45%, transparent 100%);
	}

	.msg {
		font-size: 1.15rem;
		line-height: 1.8;
		color: var(--text-soft);
		white-space: pre-line;
		min-height: 1.5em;
		opacity: 0;
		transform: translateY(6px);
		transition: opacity 0.6s ease, transform 0.6s ease;
		max-width: 340px;
		margin: 0 auto;
	}

	.msg--visible {
		opacity: 1;
		transform: translateY(0);
	}

	.msg--final {
		color: var(--text-bright);
		font-size: 1.2rem;
	}

	.msg-counter {
		font-size: 0.7rem;
		color: var(--text-muted);
		letter-spacing: 0.15em;
		margin-top: 0.5rem;
		opacity: 0;
		transition: opacity 0.4s ease;
	}

	.msg-counter--visible {
		opacity: 1;
	}

	.msg-photo {
		width: 180px;
		height: 230px;
		border-radius: 14px;
		overflow: hidden;
		border: 2px solid var(--border-subtle);
		margin: 0 auto 1rem;
		box-shadow: 0 8px 40px rgba(0, 0, 0, 0.5);
		opacity: 0;
		transform: scale(0.9) translateY(10px);
		transition: opacity 0.8s ease, transform 0.8s ease;
		display: none;
	}

	.msg-photo--visible {
		display: block;
		opacity: 1;
		transform: scale(1) translateY(0);
	}

	.msg-photo__img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
	}
</style>

<script>
	// â”€â”€ Edita tus mensajes aquÃ­ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
	const messages: string[] = [
		'Te deseo lo mejor en este dÃ­a especial',
		'Eres una persona increÃ­ble y mereces toda la felicidad del mundo',
		'Espero que hoy la pases super lindo, con tus seres queridos y haciendo lo que mÃ¡s te gusta',
		'Espero que Dios te cumpla todos los deseos de tu corazÃ³n',
		'Gracias por ser tÃº, simplemente',
	];

	const finalMessage = 'Y por ultimo pero no menos importante se que llevo poco tiempo conociÃ©ndote pero me alegra mucho haberte conocido y espero que podamos compartir muchos momentos mÃ¡s juntos y siempre que pueda hacer tu vida un poco mas feliz lo harÃ©. Te quedo deviendo el regalo pero espero que este detallito te guste, feliz cumpleaÃ±os Vale!  ajajaðŸŽ‰ GANATE ESE TORNEO';
	// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

	const layer = document.getElementById('msg-layer')!;
	const el = document.getElementById('message-display')!;
	const counterEl = document.getElementById('msg-counter')!;
	const photoEl = document.getElementById('msg-photo')!;
	let index = -1;
	let transitioning = false;

	function show(text: string, isFinal = false) {
		if (transitioning) return;
		transitioning = true;

		el.classList.remove('msg--visible');
		counterEl.classList.remove('msg-counter--visible');

		setTimeout(() => {
			el.textContent = text;
			el.classList.toggle('msg--final', isFinal);

			if (isFinal) {
				counterEl.textContent = '';
				document.dispatchEvent(new CustomEvent('messages:done'));
			} else {
				counterEl.textContent = `${index + 1} / ${messages.length}`;
			}

			requestAnimationFrame(() => {
				el.classList.add('msg--visible');
				if (!isFinal) counterEl.classList.add('msg-counter--visible');
				transitioning = false;
			});
		}, 400);
	}

	document.addEventListener('ball:interact', () => {
		index++;
		if (index < messages.length) {
			show(messages[index]);
		} else if (index === messages.length) {
			// Don't show final message here â€” FinaleScreen handles it
			document.dispatchEvent(new CustomEvent('messages:done'));
		}
	});

	document.addEventListener('welcome:done', () => {
		layer.style.opacity = '1';
	});
</script>
